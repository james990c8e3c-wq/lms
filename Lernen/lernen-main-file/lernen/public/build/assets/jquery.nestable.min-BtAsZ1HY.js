(function(n,f,h,g){var v="ontouchstart"in h,N=function(){var t=h.createElement("div"),e=h.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var l=f.getComputedStyle&&f.getComputedStyle(t,"").pointerEvents==="auto";return e.removeChild(t),!!l}(),C={contentCallback:function(t){return t.content?t.content:t.id},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"span",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:!1,fixed:!1,includeContent:!1,scroll:!1,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(t,e,l){},onDragStart:function(t,e,l){},beforeDragStop:function(t,e,l){},listRenderer:function(t,e){var l="<"+e.listNodeName+' class="'+e.listClass+'">';return l+=t,l+="</"+e.listNodeName+">"},itemRenderer:function(t,e,l,a,i){var s=n.map(t,function(r,d){return" "+d+'="'+r+'"'}).join(" "),o="<"+a.itemNodeName+s+">";return o+="<"+a.handleNodeName+' class="'+a.handleClass+'">',o+="<"+a.contentNodeName+' class="'+a.contentClass+'">',o+=e,o+="</"+a.contentNodeName+">",o+="</"+a.handleNodeName+">",o+=l,o+="</"+a.itemNodeName+">"}};function E(t,e){this.w=n(h),this.el=n(t),(e=e||C).rootClass!==g&&e.rootClass!=="dd"&&(e.listClass=e.listClass?e.listClass:e.rootClass+"-list",e.itemClass=e.itemClass?e.itemClass:e.rootClass+"-item",e.dragClass=e.dragClass?e.dragClass:e.rootClass+"-dragel",e.handleClass=e.handleClass?e.handleClass:e.rootClass+"-handle",e.collapsedClass=e.collapsedClass?e.collapsedClass:e.rootClass+"-collapsed",e.placeClass=e.placeClass?e.placeClass:e.rootClass+"-placeholder",e.noDragClass=e.noDragClass?e.noDragClass:e.rootClass+"-nodrag",e.noChildrenClass=e.noChildrenClass?e.noChildrenClass:e.rootClass+"-nochildren",e.emptyClass=e.emptyClass?e.emptyClass:e.rootClass+"-empty"),this.options=n.extend({},C,e),this.options.json!==g&&this._build(),this.init()}E.prototype={init:function(){var t=this;t.reset(),t.el.data("nestable-group",this.options.group),t.placeEl=n('<div class="'+t.options.placeClass+'"/>');var e=this.el.find(t.options.itemNodeName);n.each(e,function(s,o){var r=n(o),d=r.parent();t.setParent(r),d.hasClass(t.options.collapsedClass)&&t.collapseItem(d.parent())}),e.length||this.appendEmptyElement(this.el),t.el.on("click","button",function(s){if(!t.dragEl){var o=n(s.currentTarget),r=o.data("action"),d=o.parents(t.options.itemNodeName).eq(0);r==="collapse"&&t.collapseItem(d),r==="expand"&&t.expandItem(d)}});var l=function(s){var o=n(s.target);if(!o.hasClass(t.options.handleClass)){if(o.closest("."+t.options.noDragClass).length)return;o=o.closest("."+t.options.handleClass)}o.length&&!t.dragEl&&(t.isTouch=/^touch/.test(s.type),t.isTouch&&s.touches.length!==1||(s.preventDefault(),t.dragStart(s.touches?s.touches[0]:s)))},a=function(s){t.dragEl&&(s.preventDefault(),t.dragMove(s.touches?s.touches[0]:s))},i=function(s){t.dragEl&&(s.preventDefault(),t.dragStop(s.touches?s.changedTouches[0]:s))};v&&(t.el[0].addEventListener("touchstart",l,!1),f.addEventListener("touchmove",a,!1),f.addEventListener("touchend",i,!1),f.addEventListener("touchcancel",i,!1)),t.el.on("mousedown",l),t.w.on("mousemove",a),t.w.on("mouseup",i),t.el.bind("destroy-nestable",function(){v&&(t.el[0].removeEventListener("touchstart",l,!1),f.removeEventListener("touchmove",a,!1),f.removeEventListener("touchend",i,!1),f.removeEventListener("touchcancel",i,!1)),t.el.off("mousedown",l),t.w.off("mousemove",a),t.w.off("mouseup",i),t.el.off("click"),t.el.unbind("destroy-nestable"),t.el.data("nestable",null)})},destroy:function(){this.el.trigger("destroy-nestable")},add:function(t){var e="."+this.options.listClass,l=n(this.el).children(e);t.parent_id!==g&&(l=l.find('[data-id="'+t.parent_id+'"]'),delete t.parent_id,l.children(e).length===0&&(l=l.append(this.options.listRenderer("",this.options))),l=l.find(e+":first"),this.setParent(l.parent())),l.append(this._buildItem(t,this.options))},replace:function(t){var e=this._buildItem(t,this.options);this._getItemById(t.id).replaceWith(e)},removeItem:function(t){var e=this.options,l=this.el;(t=t||this).remove();var a="."+e.listClass+" ."+e.listClass+":not(:has(*))";n(l).find(a).remove(),n(l).find('[data-action="expand"], [data-action="collapse"]').each(function(){n(this).siblings("."+e.listClass).length===0&&n(this).remove()})},remove:function(t,e){var l=this.options,a=this,i=this._getItemById(t),s=l.effect.animation||"fade",o=l.effect.time||"slow";s==="fade"?i.fadeOut(o,function(){a.removeItem(i)}):this.removeItem(i),e&&e()},removeAll:function(t){var e=this,l=this.options,a=e.el.find(l.listNodeName).first(),i=a.children(l.itemNodeName),s=l.effect.animation||"fade",o=l.effect.time||"slow";function r(){i.each(function(){e.removeItem(n(this))}),a.show(),t&&t()}s==="fade"?a.fadeOut(o,r):r()},_getItemById:function(t){return n(this.el).children("."+this.options.listClass).find('[data-id="'+t+'"]')},_build:function(){var t=this.options.json;typeof t=="string"&&(t=JSON.parse(t)),n(this.el).html(this._buildList(t,this.options))},_buildList:function(t,e){if(!t)return"";var l="",a=this;return n.each(t,function(i,s){l+=a._buildItem(s,e)}),e.listRenderer(l,e)},_buildItem:function(t,e){var l=function(o){delete(o=n.extend({},o)).children,delete o.classes,delete o.content;var r={};return n.each(o,function(d,c){var p;typeof c=="object"&&(c=JSON.stringify(c)),r["data-"+d]=(p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},c+"".replace(/[&<>"']/g,function(u){return p[u]}))}),r}(t);l.class=function(o,r){var d=o.classes||{};typeof d=="string"&&(d=[d]);var c=function(p){var u={};for(var m in p)u[p[m]]=p[m];return u}(d);return c[r.itemClass]=r.itemClass,n.map(c,function(p){return p}).join(" ")}(t,e);var a=e.contentCallback(t),i=this._buildList(t.children,e),s=n(e.itemRenderer(l,a,i,e,t));return this.setParent(s),s[0].outerHTML},serialize:function(){var t=this,e=function(l){var a=[];return l.children(t.options.itemNodeName).each(function(){var i=n(this),s=n.extend({},i.data()),o=i.children(t.options.listNodeName);if(t.options.includeContent){var r=i.find("."+t.options.contentClass).html();r&&(s.content=r)}o.length&&(s.children=e(o)),a.push(s)}),a};return e(t.el.find(t.options.listNodeName).first())},asNestedSet:function(){var t=this.options,e=[],l=1;return this.el.find(t.listNodeName).first().children(t.itemNodeName).each(function(){l=function i(s,o,r){var d,c,p=r+1;return n(s).children(t.listNodeName).children(t.itemNodeName).length>0&&(o++,n(s).children(t.listNodeName).children(t.itemNodeName).each(function(){p=i(n(this),o,p)}),o--),d=n(s).attr("data-id"),a(d)&&(d=parseInt(d)),c=n(s).parent(t.listNodeName).parent(t.itemNodeName).attr("data-id")||"",a(c)&&(d=parseInt(c)),d&&e.push({id:d,parent_id:c,depth:o,lft:r,rgt:p}),r=p+1,r}(this,0,l)}),e=e.sort(function(i,s){return i.lft-s.lft});function a(i){return n.isNumeric(i)&&Math.floor(i)==i}},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(t){var e=n.extend({},this.options,t),l=[];return n(this.element).children(e.items).each(function(){var a=function i(s){var o=(n(s).attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/);if(o){var r={id:o[2]};return n(s).children(e.listType).children(e.items).length>0&&(r.children=[],n(s).children(e.listType).children(e.items).each(function(){var d=i(this);r.children.push(d)})),r}}(this);l.push(a)}),l},toArray:function(){var t=n.extend({},this.options,this),e=t.startDepthCount||0,l=[],a=2;return this.el.find(this.options.listNodeName).first().children(this.options.itemNodeName).each(function(){a=function i(s,o,r){var d,c,p=r+1;if(s.children(t.options.listNodeName).children(t.options.itemNodeName).length>0&&(o++,s.children(t.options.listNodeName).children(t.options.itemNodeName).each(function(){p=i(n(this),o,p)}),o--),d=s.data().id,o===e+1)c=t.rootID;else{var u=s.parent(t.options.listNodeName).parent(t.options.itemNodeName).data();c=u.id}return d&&l.push({id:d,parent_id:c,depth:o,left:r,right:p}),r=p+1,r}(n(this),e+1,a)}),l=l.sort(function(i,s){return i.left-s.left})},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options.listNodeName).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(n(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(n(this))})},setParent:function(t){t.is(this.options.itemNodeName)&&t.children(this.options.listNodeName).length&&(t.children("[data-action]").remove(),t.prepend(n(this.options.expandBtnHTML)),t.prepend(n(this.options.collapseBtnHTML)))},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(t){var e=this.mouse,l=n(t.target).closest(this.options.itemNodeName),a={top:t.pageY,left:t.pageX},i=this.options.onDragStart.call(this,this.el,l,a);if(i===void 0||i!==!1){this.placeEl.css("height",l.height()),e.offsetX=t.pageX-l.offset().left,e.offsetY=t.pageY-l.offset().top,e.startX=e.lastX=t.pageX,e.startY=e.lastY=t.pageY,this.dragRootEl=this.el,this.dragEl=n(h.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",l.outerWidth()),this.setIndexOfItem(l),l.after(this.placeEl),l[0].parentNode.removeChild(l[0]),l.appendTo(this.dragEl),n(h.body).append(this.dragEl),this.dragEl.css({left:t.pageX-e.offsetX,top:t.pageY-e.offsetY});var s,o,r=this.dragEl.find(this.options.itemNodeName);for(s=0;s<r.length;s++)(o=n(r[s]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=o)}},createSubLevel:function(t,e){var l=n("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);return e&&l.append(e),t.append(l),this.setParent(t),l},setIndexOfItem:function(t,e){(e=e||[]).unshift(t.index()),n(t[0].parentNode)[0]!==this.dragRootEl[0]?this.setIndexOfItem(n(t[0].parentNode),e):this.dragEl.data("indexOfItem",e)},restoreItemAtIndex:function(t,e){var l=this.el,a=e.length-1;function i(d,c){e[a]===0?n(d).prepend(c.clone(!0)):n(d.children[e[a]-1]).after(c.clone(!0))}for(var s=0;s<e.length;s++){if(a===parseInt(s))return void i(l,t);var o=l[0]?l[0]:l,r=o.children[e[s]];l=r||this.createSubLevel(n(o))}},dragStop:function(t){var e={top:t.pageY,left:t.pageX},l=this.dragEl.data("indexOfItem"),a=this.dragEl.children(this.options.itemNodeName).first();a[0].parentNode.removeChild(a[0]),this.dragEl.remove();var i=this.options.beforeDragStop.call(this,this.el,a,this.placeEl.parent());if(i!==void 0&&i===!1){var s=this.placeEl.parent();return this.placeEl.remove(),s.children().length||this.unsetParent(s.parent()),this.restoreItemAtIndex(a,l),void this.reset()}this.placeEl.replaceWith(a),this.hasNewRoot?(this.options.fixed===!0?this.restoreItemAtIndex(a,l):this.el.trigger("lostItem"),this.dragRootEl.trigger("gainedItem")):this.dragRootEl.trigger("change"),this.options.callback.call(this,this.dragRootEl,a,e),this.reset()},dragMove:function(t){var e,l,a,i=this.options,s=this.mouse;this.dragEl.css({left:t.pageX-s.offsetX,top:t.pageY-s.offsetY}),s.lastX=s.nowX,s.lastY=s.nowY,s.nowX=t.pageX,s.nowY=t.pageY,s.distX=s.nowX-s.lastX,s.distY=s.nowY-s.lastY,s.lastDirX=s.dirX,s.lastDirY=s.dirY,s.dirX=s.distX===0?0:s.distX>0?1:-1,s.dirY=s.distY===0?0:s.distY>0?1:-1;var o=Math.abs(s.distX)>Math.abs(s.distY)?1:0;if(!s.moving)return s.dirAx=o,void(s.moving=!0);if(i.scroll)if(f.jQuery.fn.scrollParent!==void 0){var r=!1,d=this.el.scrollParent()[0];d!==h&&d.tagName!=="HTML"?(i.scrollTriggers.bottom+d.offsetHeight-t.pageY<i.scrollSensitivity?d.scrollTop=r=d.scrollTop+i.scrollSpeed:t.pageY-i.scrollTriggers.top<i.scrollSensitivity&&(d.scrollTop=r=d.scrollTop-i.scrollSpeed),i.scrollTriggers.right+d.offsetWidth-t.pageX<i.scrollSensitivity?d.scrollLeft=r=d.scrollLeft+i.scrollSpeed:t.pageX-i.scrollTriggers.left<i.scrollSensitivity&&(d.scrollLeft=r=d.scrollLeft-i.scrollSpeed)):(t.pageY-n(h).scrollTop()<i.scrollSensitivity?r=n(h).scrollTop(n(h).scrollTop()-i.scrollSpeed):n(f).height()-(t.pageY-n(h).scrollTop())<i.scrollSensitivity&&(r=n(h).scrollTop(n(h).scrollTop()+i.scrollSpeed)),t.pageX-n(h).scrollLeft()<i.scrollSensitivity?r=n(h).scrollLeft(n(h).scrollLeft()-i.scrollSpeed):n(f).width()-(t.pageX-n(h).scrollLeft())<i.scrollSensitivity&&(r=n(h).scrollLeft(n(h).scrollLeft()+i.scrollSpeed)))}else console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information");this.scrollTimer&&clearTimeout(this.scrollTimer),i.scroll&&r&&(this.scrollTimer=setTimeout(function(){n(f).trigger(t)},10)),s.dirAx!==o?(s.distAxX=0,s.distAxY=0):(s.distAxX+=Math.abs(s.distX),s.dirX!==0&&s.dirX!==s.lastDirX&&(s.distAxX=0),s.distAxY+=Math.abs(s.distY),s.dirY!==0&&s.dirY!==s.lastDirY&&(s.distAxY=0)),s.dirAx=o,s.dirAx&&s.distAxX>=i.threshold&&(s.distAxX=0,a=this.placeEl.prev(i.itemNodeName),s.distX>0&&a.length&&!a.hasClass(i.collapsedClass)&&!a.hasClass(i.noChildrenClass)&&(e=a.find(i.listNodeName).last(),this.placeEl.parents(i.listNodeName).length+this.dragDepth<=i.maxDepth&&(e.length?(e=a.children(i.listNodeName).last()).append(this.placeEl):this.createSubLevel(a,this.placeEl))),s.distX<0&&(this.placeEl.next(i.itemNodeName).length||(l=this.placeEl.parent(),this.placeEl.closest(i.itemNodeName).after(this.placeEl),l.children().length||this.unsetParent(l.parent()))));var c=!1;if(N||(this.dragEl[0].style.visibility="hidden"),this.pointEl=n(h.elementFromPoint(t.pageX-h.body.scrollLeft,t.pageY-(f.pageYOffset||h.documentElement.scrollTop))),N||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(i.handleClass)&&(this.pointEl=this.pointEl.closest(i.itemNodeName)),this.pointEl.hasClass(i.emptyClass))c=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(i.itemClass))return;var p=this.pointEl.closest("."+i.rootClass),u=this.dragRootEl.data("nestable-id")!==p.data("nestable-id");if(!s.dirAx||u||c){if(u&&i.group!==p.data("nestable-group")||this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(i.listNodeName).length||this.dragDepth-1+this.pointEl.parents(i.listNodeName).length>i.maxDepth)return;var m=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;l=this.placeEl.parent(),c?((e=n(h.createElement(i.listNodeName)).addClass(i.listClass)).append(this.placeEl),this.pointEl.replaceWith(e)):m?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),l.children().length||this.unsetParent(l.parent()),this.dragRootEl.find(i.itemNodeName).length||this.appendEmptyElement(this.dragRootEl),this.dragRootEl=p,u&&(this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}},appendEmptyElement:function(t){t.append('<div class="'+this.options.emptyClass+'"/>')}},n.fn.nestable=function(t){var e=this,l=arguments;return"Nestable"in f||(f.Nestable={},Nestable.counter=0),this.each(function(){var a=n(this).data("nestable");if(a){if(typeof t=="string"&&typeof a[t]=="function")if(l.length>1){for(var i=[],s=1;s<l.length;s++)i.push(l[s]);e=a[t].apply(a,i)}else e=a[t]()}else Nestable.counter++,n(this).data("nestable",new E(this,t)),n(this).data("nestable-id",Nestable.counter)}),e||this}})(window.jQuery||window.Zepto,window,document);
